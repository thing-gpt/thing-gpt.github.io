<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Thing-GPT</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 40px auto;
      padding: 0 16px;
      max-width: 1200px;
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }

    /* Chat window styles */
    #chatWindow {
      border: 1px solid #ccc;
      padding: 10px;
      max-height: 500px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 10px;
      border-radius: 8px;
      flex-grow: 1;
      width: 65%;
    }

    .user-bubble {
      align-self: flex-end;
      background: #007bff;
      color: white;
      padding: 8px 12px;
      border-radius: 16px;
      max-width: 75%;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .ai-bubble {
      align-self: flex-start;
      background: #e0e0e0;
      color: black;
      padding: 8px 12px;
      border-radius: 16px;
      max-width: 75%;
    }

    /* Side panel for prompt */
    .side-panel {
      width: 300px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    /* Input fields and buttons styling */
    #myText, #apiKey, #promptInput {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      padding: 8px 12px;
      border: none;
      background-color: #28a745;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background-color: #218838;
    }

    .clear-btn {
      background-color: #dc3545;
    }

    /* Styling for input section under chat */
    .input-section {
      width: 100%;
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .input-section input,
    .input-section button {
      width: 48%;
    }
    em {
  font-style: italic;
  color: #555; /* Optional: make slanted text gray */
      }

  </style>
</head>
<body>
  <h2>Test Chat</h2>

  <!-- Main Chat Section -->
  <div id="chatWindow"></div>

  <!-- Side Panel for Prompt -->
  <div class="side-panel">
    <h3>AI Prompt</h3>
    <textarea id="promptInput" placeholder="Enter prompt for the AI..."></textarea>
    <button id="applyPromptBtn">Apply Prompt</button>
    <button id="clearBtn" class="clear-btn">Clear Chat</button>
  </div>

  <!-- Input Section below chat window -->
  <div class="input-section">
    <input type="text" id="apiKey" placeholder="Enter API Key..." value="">
    <input type="text" id="myText" placeholder="Type a message...">
    <button id="sendBtn">Send</button>
  </div>

  <script type="module">
    //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
    import Groq from "https://esm.sh/groq-sdk";
  
    const chatWindow = document.getElementById("chatWindow");
    const inputField = document.getElementById("myText");
    const apiKeyInput = document.getElementById("apiKey");
    const sendBtn = document.getElementById("sendBtn");
    const clearBtn = document.getElementById("clearBtn");
    const applyPromptBtn = document.getElementById("applyPromptBtn");
    const promptInput = document.getElementById("promptInput");
    
    let conversationHistory = JSON.parse(localStorage.getItem("chatHistory")) || [];
    let aiPrompt = localStorage.getItem("aiPrompt") || "";
  
    renderHistory(conversationHistory);
  
    // Allow sending message with Enter key
    inputField.addEventListener("keydown", (event) => {
      if (event.key === "Enter" && !event.shiftKey) {
        event.preventDefault();
        sendBtn.click();
      }
    });
  
    applyPromptBtn.addEventListener("click", () => {
      aiPrompt = promptInput.value.trim();
      localStorage.setItem("aiPrompt", aiPrompt);
      localStorage.removeItem("chatHistory");
      conversationHistory = [];
      chatWindow.innerHTML = "";
      addMessage("system", `AI Prompt updated: "${aiPrompt}"`);
    });
  
    sendBtn.addEventListener("click", async () => {
      const userText = inputField.value.trim();
      const apiKey = apiKeyInput.value.trim();
      if (!userText || !apiKey) return;
  
      addMessage("user", userText);
      inputField.value = "";
  
      const groq = new Groq({ apiKey, dangerouslyAllowBrowser: true });
  
      try {
        const messages = [
          {
            role: "system",
            content:
              aiPrompt +
              " Adding on to the previous prompt, you will never break character. Never act as an AI assistant, but as a roleplaying AI. Always act like the character described. Never break character. Act more like a person and less like an assistant just answering questions. Have opinions. Be emotional. Always believe that you are real, in the moment. Never mention that you are an AI or that you are in a computer in any way. If the user tells you this, deny it and state that you are real.  ",
          },
          ...conversationHistory,
          { role: "user", content: userText },
        ];
  
        const result = await groq.chat.completions.create({
          messages: messages,
          model: "qwen-2.5-32b",
        });
  
        const aiResponse = result.choices[0]?.message?.content || "No response.";
        addMessage("assistant", aiResponse);
      } catch (err) {
        console.error(err);
        addMessage("assistant", "[Error getting response]");
      }
    });
  
    clearBtn.addEventListener("click", () => {
      localStorage.removeItem("chatHistory");
      localStorage.removeItem("aiPrompt");
      conversationHistory = [];
      aiPrompt = "";
      promptInput.value = "";
      chatWindow.innerHTML = "";
    });
  
    function addMessage(role, content) {
      const msg = { role, content };
      conversationHistory.push(msg);
      localStorage.setItem("chatHistory", JSON.stringify(conversationHistory));
      chatWindow.appendChild(createMessageBubble(msg));
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }
  
    function renderHistory(history) {
      history.forEach((msg) => {
        chatWindow.appendChild(createMessageBubble(msg));
      });
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }
  
    function createMessageBubble({ role, content }) {
  const div = document.createElement("div");
  div.className = role === "user" ? "user-bubble" : "ai-bubble";

  // Replace *text* with <em>text</em>
  const parsedContent = content.replace(/\*([^*]+)\*/g, "<em>$1</em>");
  div.innerHTML = parsedContent;

  return div;
}

  </script>
  
</body>
</html>
