<!DOCTYPE html>
<html>
  <body>
    <input type="text" id="myText" placeholder="Enter your text...">
    <input type="text" id="apiKey" value="gsk_..." placeholder="Enter your API key">
    <button id="myButton">Try it</button>
    <p id="myText"></p>
    <p id="demo"></p>

    <script type="module">
      import Groq from "https://esm.sh/groq-sdk";

      // Load from localStorage if available
      let conversationHistory = [];
      const stored = localStorage.getItem("chatHistory");
      if (stored) {
        try {
          conversationHistory = JSON.parse(stored);
        } catch (err) {
          console.error("Failed to parse stored chat history");
        }
      }

      document.getElementById("myButton").addEventListener("click", async () => {
        const userText = document.getElementById("myText").value;
        const apiKey = document.getElementById("apiKey").value;

        if (!apiKey) {
          document.getElementById("demo").textContent = "Please enter your API key.";
          return;
        }

        conversationHistory.push({ role: "user", content: userText });

        const groq = new Groq({ apiKey, dangerouslyAllowBrowser: true });

        try {
          const result = await groq.chat.completions.create({
            messages: conversationHistory,
            model: "qwen-2.5-32b",
          });

          const response = result.choices[0]?.message?.content || "No response.";
          conversationHistory.push({ role: "assistant", content: response });

          // Save to localStorage thanks chatgpt
          localStorage.setItem("chatHistory", JSON.stringify(conversationHistory));

          document.getElementById("demo").textContent = response;
        } catch (error) {
          console.error(error);
          document.getElementById("demo").textContent = "Error fetching response.";
        }
      });
    </script>
  </body>
</html>
